<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ржЖржЗржирзЗрж░ ржЦрзЗрж▓рж╛рзЯ ржмрзБржжрзНржзрж┐рж░ ржкрж░рзАржХрзНрж╖рж╛ - Black Force 007</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align:center; padding:10px; background:#f8f9fa;}
    #game-container { max-width:600px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.1);}
    button { padding:10px 20px; margin:5px; cursor:pointer; border:none; border-radius:5px; }
    #options-container button { display:block; width:100%; margin:5px 0; font-size:1em; }
    .correct { background-color: #28a745 !important; color:#fff; font-weight:bold; font-size:1.2em; }
    .wrong { background-color: #dc3545 !important; color:#fff; font-weight:bold; }
    .hidden { display:none; }
  </style>
</head>
<body>
<div id="game-container">
  <h1 class="title">ржЖржЗржирзЗрж░ ржЦрзЗрж▓рж╛рзЯ ржмрзБржжрзНржзрж┐рж░ ржкрж░рзАржХрзНрж╖рж╛</h1>
  <h3 class="subtitle">тЪФя╕П Black Force 007 тЪФя╕П</h3>

  <!-- Login / Signup -->
  <div id="login-screen">
    <h2>Login / Signup ржХрж░рзБржи</h2>
    <input type="email" id="email" placeholder="ржЖржкржирж╛рж░ ржЗржорзЗржЗрж▓">
    <input type="password" id="password" placeholder="ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб">
    <button onclick="signup()">Sign Up</button>
    <button onclick="login()">Login</button>
    <p id="auth-msg" style="color:red;"></p>
  </div>

  <!-- Quiz Screen -->
  <div id="quiz-screen" class="hidden">
    <div class="player-info">
      <p><strong>ржЦрзЗрж▓рзЛржпрж╝рж╛ржбрж╝:</strong> <span id="display-name"></span></p>
      <p>рж╕ржарж┐ржХ: <span id="correct-count">0</span> | ржнрзБрж▓: <span id="wrong-count">0</span> | тП░ <span id="timer">30</span> рж╕рзЗржХрзЗржирзНржб</p>
      <p>ржХржпрж╝рзЗржи ЁЯТ░: <span id="coins">0</span></p>
    </div>
    <div class="question-box"><table><tr><th id="question-text"></th></tr></table></div>
    <div id="options-container"></div>
    <button id="next-btn" class="hidden">ржкрж░рзЗрж░ ржкрзНрж░рж╢рзНржи тЮбя╕П</button>
    <div id="leaderboard">
      <h3>ЁЯПЖ рж▓рж┐ржбрж╛рж░ржмрзЛрж░рзНржб ЁЯПЖ</h3>
      <ul id="leaderboard-list"></ul>
    </div>
  </div>
</div>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBC0mvjp67LkXyRqepDP7COVET0E0BRDzI",
  authDomain: "blackforce007-otp.firebaseapp.com",
  projectId: "blackforce007-otp",
  storageBucket: "blackforce007-otp.firebasestorage.app",
  messagingSenderId: "889099609974",
  appId: "1:889099609974:web:755f03e0bfbe7713213c57"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();

let questions=[], currentQuestion=0, correctCount=0, wrongCount=0, coins=0, timerInterval, timeLeft=30;
const nextBtn = document.getElementById("next-btn");

// Signup
function signup(){
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  if(!email || !password){ document.getElementById("auth-msg").innerText="рж╕ржм ржлрж┐рж▓рзНржб ржкрзВрж░ржг ржХрж░рзБржи"; return; }

  auth.createUserWithEmailAndPassword(email,password)
  .then(user=>{ startQuiz(user.user); })
  .catch(err=>document.getElementById("auth-msg").innerText=err.message);
}

// Login
function login(){
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  if(!email || !password){ document.getElementById("auth-msg").innerText="рж╕ржм ржлрж┐рж▓рзНржб ржкрзВрж░ржг ржХрж░рзБржи"; return; }

  auth.signInWithEmailAndPassword(email,password)
  .then(user=>{ startQuiz(user.user); })
  .catch(err=>document.getElementById("auth-msg").innerText=err.message);
}

// Start Quiz
async function startQuiz(user){
  const playerName = user.email;
  document.getElementById("login-screen").classList.add("hidden");
  document.getElementById("quiz-screen").classList.remove("hidden");
  document.getElementById("display-name").innerText = playerName;

  // Load questions
  const res = await fetch("questions.json");
  questions = await res.json();
  shuffleArray(questions);
  if(questions.length>30) questions = questions.slice(0,30);

  showQuestion();
  startTimer();
  loadLeaderboard();
}

// Show question
function showQuestion(){
  document.getElementById("options-container").innerHTML="";
  const q = questions[currentQuestion];
  document.getElementById("question-text").innerText = q.question;
  let shuffled = [...q.options]; shuffleArray(shuffled);
  shuffled.forEach(opt=>{
    const btn = document.createElement("button");
    btn.innerText = opt; btn.classList.add("option");
    btn.addEventListener("click",()=>selectAnswer(btn,q.answer));
    document.getElementById("options-container").appendChild(btn);
  });
  nextBtn.classList.add("hidden");
}

// Select answer
function selectAnswer(btn, correctAns){
  const allOptions = document.querySelectorAll(".option"); allOptions.forEach(b=>b.disabled=true);
  if(btn.innerText===correctAns){ btn.classList.add("correct"); correctCount++; coins+=10; }
  else{ btn.classList.add("wrong"); wrongCount++; allOptions.forEach(o=>{ if(o.innerText===correctAns) o.classList.add("correct"); }); }

  document.getElementById("correct-count").innerText=correctCount;
  document.getElementById("wrong-count").innerText=wrongCount;
  document.getElementById("coins").innerText=coins;
  nextBtn.classList.remove("hidden");
}

// Next
nextBtn.addEventListener("click",()=>{
  currentQuestion++; if(currentQuestion<questions.length){ showQuestion(); resetTimer(); }
  else{ endGame(); }
});

// Timer
function startTimer(){
  timeLeft=30; document.getElementById("timer").innerText=timeLeft;
  timerInterval=setInterval(()=>{
    timeLeft--; document.getElementById("timer").innerText=timeLeft;
    if(timeLeft<=0){ clearInterval(timerInterval); currentQuestion++; if(currentQuestion<questions.length){ showQuestion(); resetTimer(); } else{ endGame(); } }
  },1000);
}
function resetTimer(){ clearInterval(timerInterval); startTimer(); }
function shuffleArray(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } }

// End Game
function endGame(){
  clearInterval(timerInterval);
  const user = auth.currentUser;
  if(user){
    database.ref('leaderboard/'+user.uid).set({
      name:user.email, coins:coins, correct:correctCount, wrong:wrongCount, timestamp:Date.now()
    });
  }
  alert(`ржЧрзЗржо рж╢рзЗрж╖! тЬЕ\nрж╕ржарж┐ржХ: ${correctCount} | ржнрзБрж▓: ${wrongCount} | ржХрзЯрзЗржи: ${coins}`);
  currentQuestion=0; correctCount=0; wrongCount=0; coins=0;
  document.getElementById("quiz-screen").classList.add("hidden");
}

// Leaderboard
function loadLeaderboard(){
  database.ref('leaderboard').orderByChild('coins').limitToLast(10).on('value',snap=>{
    const list = document.getElementById("leaderboard-list"); list.innerHTML="";
    const arr = []; snap.forEach(child=>arr.push(child.val())); arr.reverse();
    arr.forEach((p,i)=>{ const li=document.createElement("li"); li.textContent=`${i+1}. ${p.name} тАФ ${p.coins}ЁЯТ░`; list.appendChild(li); });
  });
}
</script>
</body>
</html>

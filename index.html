<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡¶Ü‡¶á‡¶®‡ßá‡¶∞ ‡¶ñ‡ßá‡¶≤‡¶æ‡ßü ‡¶¨‡ßÅ‡¶¶‡ßç‡¶ß‡¶ø‡¶∞ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ - Black Force 007</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align:center; padding:10px; background:#f8f9fa;}
    #game-container { max-width:600px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.1);}
    button { padding:10px 20px; margin:5px; cursor:pointer; border:none; border-radius:5px; }
    #options-container button { display:block; width:100%; margin:5px 0; font-size:1em; }
    .correct { background-color: #28a745 !important; color:#fff; font-weight:bold; font-size:1.2em; }
    .wrong { background-color: #dc3545 !important; color:#fff; font-weight:bold; }
    .hidden { display:none; }
  </style>
</head>
<body>

<div id="game-container">
  <h1 class="title">‡¶Ü‡¶á‡¶®‡ßá‡¶∞ ‡¶ñ‡ßá‡¶≤‡¶æ‡ßü ‡¶¨‡ßÅ‡¶¶‡ßç‡¶ß‡¶ø‡¶∞ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ</h1>
  <h3 class="subtitle">‚öîÔ∏è Black Force 007 ‚öîÔ∏è</h3>

  <!-- Login / Signup -->
  <div id="login-screen">
    <h2>Login / Signup ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
    <input type="email" id="email" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
    <input type="password" id="password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
    <button onclick="signup()">Sign Up</button>
    <button onclick="login()">Login</button>
    <p id="auth-msg" style="color:red;"></p>
  </div>

  <!-- Quiz Screen -->
  <div id="quiz-screen" class="hidden">
    <div class="player-info">
      <p><strong>‡¶ñ‡ßá‡¶≤‡ßã‡¶Ø‡¶º‡¶æ‡¶°‡¶º:</strong> <span id="display-name"></span></p>
      <p>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞: <span id="correct-count">0</span> | ‡¶≠‡ßÅ‡¶≤: <span id="wrong-count">0</span> | ‚è∞ <span id="timer">30</span> ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°</p>
      <p>‡¶ï‡¶Ø‡¶º‡ßá‡¶® üí∞: <span id="coins">0</span></p>
    </div>

    <div class="question-box">
      <table><tr><th id="question-text"></th></tr></table>
    </div>

    <div id="options-container"></div>
    <button id="next-btn" class="hidden">‡¶™‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‚û°Ô∏è</button>

    <div id="leaderboard">
      <h3>üèÜ ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶° üèÜ</h3>
      <ul id="leaderboard-list"></ul>
    </div>
  </div>
</div>

<!-- Firebase Auth Script -->
<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com/",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();

// Signup Function
function signup() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  auth.createUserWithEmailAndPassword(email,password)
    .then(userCredential => { 
      document.getElementById("login-screen").classList.add("hidden");
      startQuiz(userCredential.user);
    })
    .catch(error => { document.getElementById("auth-msg").innerText = error.message; });
}

// Login Function
function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  auth.signInWithEmailAndPassword(email,password)
    .then(userCredential => { 
      document.getElementById("login-screen").classList.add("hidden");
      startQuiz(userCredential.user);
    })
    .catch(error => { document.getElementById("auth-msg").innerText = error.message; });
}
</script>

<!-- Quiz Script -->
<script>
let questions=[], currentQuestion=0, correctCount=0, wrongCount=0, coins=0, timerInterval, timeLeft=30, playerName="", leaderboard=[];
const nextBtn = document.getElementById("next-btn");

// Start Quiz
async function startQuiz(user){
  playerName = user.email;
  document.getElementById("quiz-screen").classList.remove("hidden");
  document.getElementById("display-name").innerText = playerName;

  // Load questions
  const res = await fetch("questions.json");
  questions = await res.json();
  shuffleArray(questions);
  if(questions.length>30) questions = questions.slice(0,30);

  showQuestion();
  startTimer();
  loadLeaderboardFirebase();
}

// Show Question
function showQuestion(){
  document.getElementById("options-container").innerHTML="";
  const q = questions[currentQuestion];
  document.getElementById("question-text").innerText = q.question;
  let shuffled = [...q.options];
  shuffleArray(shuffled);
  shuffled.forEach(option=>{
    const btn = document.createElement("button");
    btn.innerText = option;
    btn.classList.add("option");
    btn.addEventListener("click",()=>selectAnswer(btn,q.answer));
    document.getElementById("options-container").appendChild(btn);
  });
  nextBtn.classList.add("hidden");
}

// Select Answer
function selectAnswer(btn, correctAns){
  const allOptions = document.querySelectorAll(".option");
  allOptions.forEach(b=>b.disabled=true);
  if(btn.innerText===correctAns){
    btn.classList.add("correct"); correctCount++; coins+=10;
  }else{
    btn.classList.add("wrong"); wrongCount++;
    allOptions.forEach(o=>{ if(o.innerText===correctAns) o.classList.add("correct"); });
  }
  document.getElementById("correct-count").innerText=correctCount;
  document.getElementById("wrong-count").innerText=wrongCount;
  document.getElementById("coins").innerText=coins;
  nextBtn.classList.remove("hidden");
}

// Next Question
nextBtn.addEventListener("click",()=>{
  currentQuestion++;
  if(currentQuestion<questions.length){ showQuestion(); resetTimer(); }
  else { endGame(); }
});

// Timer
function startTimer(){ timeLeft=30; document.getElementById("timer").innerText=timeLeft;
timerInterval=setInterval(()=>{ timeLeft--; document.getElementById("timer").innerText=timeLeft;
if(timeLeft<=0){ clearInterval(timerInterval); currentQuestion++; if(currentQuestion<questions.length){ showQuestion(); resetTimer(); } else{ endGame(); } } },1000); }

function resetTimer(){ clearInterval(timerInterval); startTimer(); }
function shuffleArray(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } }

// End Game
function endGame(){
  clearInterval(timerInterval);
  alert(`${playerName}, ‡¶ó‡ßá‡¶Æ ‡¶∂‡ßá‡¶∑! ‚úÖ\n‡¶∏‡¶†‡¶ø‡¶ï: ${correctCount} | ‡¶≠‡ßÅ‡¶≤: ${wrongCount} | ‡¶ï‡ßü‡ßá‡¶®: ${coins}`);
  // Firebase update
  const user = firebase.auth().currentUser;
  if(user){
    firebase.database().ref('leaderboard/'+user.uid).set({
      name:playerName, coins:coins, correct:correctCount, wrong:wrongCount, timestamp:Date.now()
    });
  }
  // Reset
  currentQuestion=0; correctCount=0; wrongCount=0; coins=0;
  document.getElementById("quiz-screen").classList.add("hidden");
}

// Load Leaderboard from Firebase
function loadLeaderboardFirebase(){
  firebase.database().ref('leaderboard').orderByChild('coins').limitToLast(10)
  .on('value', snapshot=>{
    const list=document.getElementById("leaderboard-list");
    list.innerHTML="";
    const players=[];
    snapshot.forEach(child=>{players.push(child.val());});
    players.reverse(); // top score first
    players.forEach((p,i)=>{
      const li=document.createElement("li");
      li.textContent=`${i+1}. ${p.name} ‚Äî ${p.coins}üí∞`;
      list.appendChild(li);
    });
  });
}
</script>

</body>
</html>
